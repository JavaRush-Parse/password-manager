<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<body>

<div th:fragment="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium text-gray-900">
                    Audit History - <span th:text="${vaultItem.name}"></span>
                </h3>
                <button onclick="document.getElementById('modal-placeholder').innerHTML = ''"
                        class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="max-h-96 overflow-y-auto">
                <div th:if="${#lists.isEmpty(auditHistory)}" class="text-center text-gray-500 py-8">
                    No audit history found for this item.
                </div>

                <div th:unless="${#lists.isEmpty(auditHistory)}" class="space-y-4">
                    <div th:each="audit : ${auditHistory}" class="border-b border-gray-200 pb-3 last:border-b-0">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <span th:if="${audit.actionType.name() == 'CREATE'}"
                                          th:text="${audit.actionType}"
                                          class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    </span>
                                    <span th:if="${audit.actionType.name() == 'UPDATE'}"
                                          th:text="${audit.actionType}"
                                          class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    </span>
                                    <span th:if="${audit.actionType.name() == 'DELETE'}"
                                          th:text="${audit.actionType}"
                                          class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                    </span>
                                    <span th:if="${audit.fieldName != '*'}"
                                          class="ml-2 text-sm font-medium text-gray-700"
                                          th:text="'Field: ' + ${audit.fieldName}">
                                    </span>
                                </div>

                                <div th:if="${audit.actionType.name() == 'UPDATE' and audit.fieldName != '*'}"
                                     class="text-sm text-gray-600">
                                    <div th:if="${audit.oldValue}">
                                        <span class="font-medium">From:</span>
                                        <span th:text="${audit.oldValue}" class="text-red-600"></span>
                                    </div>
                                    <div th:if="${audit.newValue}">
                                        <span class="font-medium">To:</span>
                                        <span th:text="${audit.newValue}" class="text-green-600"></span>
                                    </div>
                                </div>

                                <div th:if="${audit.actionType.name() == 'CREATE'}"
                                     class="text-sm text-gray-600">
                                    <span class="font-medium">Item created</span>
                                </div>

                                <div th:if="${audit.actionType.name() == 'DELETE'}"
                                     class="text-sm text-gray-600">
                                    <span class="font-medium text-red-600">Item deleted</span>
                                </div>
                            </div>

                            <div class="ml-4 text-right">
                                <div class="text-xs text-gray-500"
                                     th:text="${#temporals.format(audit.changedAt, 'MMM dd HH:mm')}">
                                </div>
                                <div class="text-xs text-gray-400" th:text="${audit.changedBy}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4 text-center">
                <button onclick="document.getElementById('modal-placeholder').innerHTML = ''"
                        class="px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<div th:fragment="error" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Error</h3>
            <p class="text-gray-600 mb-4">Unable to load audit history.</p>
            <button onclick="document.getElementById('modal-placeholder').innerHTML = ''"
                    class="px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300">
                Close
            </button>
        </div>
    </div>
</div>

</body>
</html>