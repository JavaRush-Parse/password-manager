<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<body>

<div th:fragment="vaultTable" id="vault-table-container" class="rounded border border-gray-300 shadow-sm container">
    <!-- Pagination Controls - Top -->
    <div class="flex justify-between items-center px-4 py-3 border-b border-gray-300">
        <div class="flex items-center space-x-2">
            <span class="text-sm text-gray-700">Items per page:</span>
            <div class="relative inline-flex group">
                <span class="inline-flex divide-x divide-gray-300 overflow-hidden rounded border border-gray-300 bg-white shadow-sm">
                    <button type="button"
                            id="page-size-button"
                            class="px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:relative"
                            th:text="${pageSize}">10</button>
                    <button type="button"
                            class="px-3 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:relative group-focus-within:bg-gray-50"
                            aria-label="Page size options">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"/>
                        </svg>
                    </button>
                </span>
                <div id="page-size-dropdown"
                     role="menu"
                     class="absolute end-0 top-12 z-10 w-20 overflow-hidden rounded border border-gray-300 bg-white shadow-sm opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200">
                    <button type="button"
                            th:attr="hx-get=${query != null && query != '' ? '/vault/table-search?query=' + query + '&size=5&page=0' : '/vault/table?size=5&page=0'}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="block w-full px-3 py-2 text-left text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:bg-gray-50"
                            role="menuitem">5</button>
                    <button type="button"
                            th:attr="hx-get=${query != null && query != '' ? '/vault/table-search?query=' + query + '&size=10&page=0' : '/vault/table?size=10&page=0'}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="block w-full px-3 py-2 text-left text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:bg-gray-50"
                            role="menuitem">10</button>
                    <button type="button"
                            th:attr="hx-get=${query != null && query != '' ? '/vault/table-search?query=' + query + '&size=20&page=0' : '/vault/table?size=20&page=0'}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="block w-full px-3 py-2 text-left text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:bg-gray-50"
                            role="menuitem">20</button>
                    <button type="button"
                            th:attr="hx-get=${query != null && query != '' ? '/vault/table-search?query=' + query + '&size=50&page=0' : '/vault/table?size=50&page=0'}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="block w-full px-3 py-2 text-left text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:bg-gray-50"
                            role="menuitem">50</button>
                    <button type="button"
                            th:attr="hx-get=${query != null && query != '' ? '/vault/table-search?query=' + query + '&size=100&page=0' : '/vault/table?size=100&page=0'}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="block w-full px-3 py-2 text-left text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 hover:text-gray-900 focus:bg-gray-50"
                            role="menuitem">100</button>
                </div>
            </div>
        </div>
        <div class="text-sm text-gray-700">
            <span>Showing </span>
            <span th:text="${currentPage * pageSize + 1}">1</span>
            <span> to </span>
            <span th:text="${(currentPage + 1) * pageSize < totalItems ? (currentPage + 1) * pageSize : totalItems}">10</span>
            <span> of </span>
            <span th:text="${totalItems}">0</span>
            <span> items</span>
        </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y-2 divide-gray-200">
            <thead class="ltr:text-left rtl:text-right">
                <tr class="*:font-medium *:text-gray-900">
                    <th class="px-3 py-2 whitespace-nowrap">Name</th>
                    <th class="px-3 py-2 whitespace-nowrap">Resource</th>
                    <th class="px-3 py-2 whitespace-nowrap">Description</th>
                    <th class="px-3 py-2 whitespace-nowrap">Login</th>
                    <th class="px-3 py-2 whitespace-nowrap">Actions</th>
                </tr>
            </thead>

            <tbody class="bg-white divide-y divide-gray-200">
                <tr th:each="vaultItem : ${vaultItems}" class="*:text-gray-900 *:first:font-medium">
                    <td class="px-3 py-2 whitespace-nowrap">
                        <a th:href="@{/vault-item/{id}(id=${vaultItem.id})}"
                           th:text="${vaultItem.name}"
                           class="text-gray-900 hover:underline">
                        </a>
                    </td>
                    <td th:text="${vaultItem.resource}" class="px-3 py-2 whitespace-nowrap"></td>
                    <td th:text="${vaultItem.description}" class="px-3 py-2 whitespace-nowrap"></td>
                    <td th:text="${vaultItem.login}" class="px-3 py-2 whitespace-nowrap"></td>
                    <td class="px-3 py-2 whitespace-nowrap">
                        <button hx:get="@{/vault-item/edit/{id}(id=${vaultItem.id})}"
                            hx-target="body"
                            hx-swap="beforeend"
                            class="btn-secondary">
                            Edit
                        </button>
<!--                        <button hx-get=@{/vault-item/audit-modal/{id}(id=${vaultItem.id})}-->
<!--                                hx-target="#modal-placeholder"-->
<!--                                class="px-3 py-2 whitespace-nowrap ml-2 text-green-600 hover:underline bg-transparent border-0 cursor-pointer">-->
<!--                            View History-->
<!--                        </button>-->
                        <form th:action="@{/vault-item/delete/{id}(id=${vaultItem.id})}"
                              th:method="delete"
                              class="inline-block ml-2"
                              onsubmit="return confirm('Are you sure you want to delete this item?');">
                            <button type="submit"
                                    class="inline-block rounded px-3 py-2 text-xm font-medium text-black
                                   border-2 border-transparent transition-colors
                                   hover:border-red-700">
                                Remove
                            </button>
                        </form>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(vaultItems)}">
                    <td colspan="5" class="px-3 py-8 text-center text-gray-500">
                        No items found
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls - Bottom -->
    <div class="flex justify-center items-center px-4 py-3 border-t border-gray-300">
        <nav aria-label="Pagination">
            <ul class="flex justify-center gap-1 text-gray-900">
                <!-- Previous Button -->
                <li>
                    <button th:if="${currentPage > 0}"
                            th:attr="hx-get=${query != null && query != '' ?
                                '/vault/table-search?query=' + query + '&page=' + (currentPage - 1) + '&size=' + pageSize :
                                '/vault/table?page=' + (currentPage - 1) + '&size=' + pageSize}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="grid size-8 place-content-center rounded border border-gray-200 transition-colors hover:bg-gray-50 rtl:rotate-180"
                            aria-label="Previous page">
                        <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <span th:if="${currentPage == 0}"
                          class="grid size-8 place-content-center rounded border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed rtl:rotate-180"
                          aria-label="Previous page">
                        <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </span>
                </li>

                <!-- Page Numbers -->
                <th:block th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}">
                    <li th:if="${pageNum == currentPage}">
                        <span class="block size-8 rounded border border-gray-900 bg-gray-900 text-center text-sm/8 font-medium text-white"
                              th:text="${pageNum + 1}">1</span>
                    </li>
                    <li th:if="${pageNum != currentPage && (pageNum == 0 || pageNum == totalPages - 1 || (pageNum >= currentPage - 2 && pageNum <= currentPage + 2))}">
                        <button th:attr="hx-get=${query != null && query != '' ?
                                    '/vault/table-search?query=' + query + '&page=' + pageNum + '&size=' + pageSize :
                                    '/vault/table?page=' + pageNum + '&size=' + pageSize}"
                                hx-target="#vault-table-container"
                                hx-swap="outerHTML"
                                class="block size-8 rounded border border-gray-200 text-center text-sm/8 font-medium text-gray-700 transition-colors hover:bg-gray-50"
                                th:text="${pageNum + 1}">1</button>
                    </li>
                    <li th:if="${pageNum != currentPage && pageNum != 0 && pageNum != totalPages - 1 && (pageNum == currentPage - 3 || pageNum == currentPage + 3)}">
                        <span class="block size-8 text-center text-sm/8 font-medium text-gray-400">...</span>
                    </li>
                </th:block>

                <!-- Next Button -->
                <li>
                    <button th:if="${currentPage < totalPages - 1}"
                            th:attr="hx-get=${query != null && query != '' ?
                                '/vault/table-search?query=' + query + '&page=' + (currentPage + 1) + '&size=' + pageSize :
                                '/vault/table?page=' + (currentPage + 1) + '&size=' + pageSize}"
                            hx-target="#vault-table-container"
                            hx-swap="outerHTML"
                            class="grid size-8 place-content-center rounded border border-gray-200 transition-colors hover:bg-gray-50 rtl:rotate-180"
                            aria-label="Next page">
                        <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <span th:if="${currentPage >= totalPages - 1}"
                          class="grid size-8 place-content-center rounded border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed rtl:rotate-180"
                          aria-label="Next page">
                        <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </span>
                </li>
            </ul>
        </nav>
    </div>
</div>


</body>
</html>
